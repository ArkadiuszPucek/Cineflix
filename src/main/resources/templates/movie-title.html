<!DOCTYPE html>
<html lang="pl" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ViaPlay</title>
    <link rel="stylesheet" href="/styles/main.css" th:href="@{/styles/main.css}" type="text/css">
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <link rel="stylesheet" type="javascript" th:href="@{/static/scripts/common.js}"/>
    <script src="../static/scripts/common.js"></script>

</head>
<body>

<div id="content-wrapper" class>
    <div class="dockable"></div>
    <div id="react-mount">
        <div class="Layout-module-internal-page--krBv">
            <div th:replace="~{header :: header}"></div>
            <div class="dockable"></div>
            <div class="blocksEnsembleContainer-module-container-ZXS1I">
                <div id="content" class="article" data-testhook="article">
                    <div class="dockable"></div>
                    <div class="blocksEnsembleContainer-module-container-ZXS1I">

                        <div class="ProductPage-module-container-oTkLV">
                            <div>
                                <div class="Hero-module-wrapper-7yHRB">
                                    <img class="Hero-module-image-NlipI Hero-module-hideImage-CCOEY Hero-module-showImage-09J4b"
                                         th:src="${movie.backgroundImageUrl}">
                                </div>
                                <div class="Hero-module-backdrop-be6rg"></div>
                                <div class="Hero-module-gradient-ieQvj"></div>
                            </div>
                            <section class="ProductPage-module-product-Him4n">
                                <div class="Scaffold-module-scaffold-F6aIC">

                                    <div class="ProductPage-module-upper-prt34">
                                        <div class="ProductPage-module-left-xugw2">
                                            <div>
                                                <div class="Thumb-module-container-mWyvN">
                                                    <img class="Thumb-module-poster-gpHtA" th:src="${movie.imageUrl}">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ProductPage-module-wrapper-WZR1p">
                                            <div>
                                                <h1 class="Title-module-container-WuaoJ" th:text="${movie.title}">
                                                    Title
                                                </h1>
                                                <div class="ActionButton-module-container-iom96 ActionButton-module-product-qJKhU ActionButton-module-isLoggedIn-J00sd">
                                                    <div class="ActionButton-module-wrapper-movie-Gds43s">
                                                        <form class="movie-button" th:action="@{/add-movie-to-history/{imdbId}(imdbId=${movie.imdbId})}" method="post">
                                                            <button type="submit" class="PlayButtonText-module-container-tunCR Buttons-module-primary--YHdl Buttons-module-play-AAOaC" tabindex="0">
                                                                <span>Obejrzyj film</span>
                                                            </button>
                                                        </form>
                                                    </div>
                                                    <a class="MyList-module-container-zkH2- Buttons-module-secondary-br7-v Buttons-module-icon-ODVKH"
                                                       tabindex="0">
                                                        <div class="MyList-module-myList-kmBI5"
                                                             data-testhook="item-star"
                                                             th:classappend="${movie.onUserList ? 'MyList-module-active-T4Dnx' : ''}"
                                                             th:attr="data-imdb-id=${movie.imdbId}"></div>
                                                    </a>
                                                    <a class="Rate-module-container-SmrTr Buttons-module-secondary-br7-v Buttons-module-icon-ODVKH"
                                                       data-testhook="rate-button-no-rating" tabindex="0">
                                                        <div class="Rate-module-rate-GCdtz undefined"></div>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="ProductPage-module-meta-wyb-3">
                                        <div class="ProductPage-module-metaLeft-VrEtc">
                                            <p class="Facts-module-container-dFnqo">
                                                    <span class="Divider-module-divider-U-3-- Divider-module-hasDefaultTypography-Uy4EO">
                                                        <a class="ImdbRating-module-link-yYfI- ImdbRating-module-facts-DWrMz ImdbRating-module-hasDefaultTypography-luAjW"
                                                           th:href="@{${movie.imdbUrl}}" target="_blank"
                                                           rel="noopener noreferrer nofollow" tabindex="-1"
                                                           th:text="${movie.imdbRating}">
                                                            Imdb rating
                                                        </a>
                                                    </span>
                                                <span class="Divider-module-divider-U-3-- Divider-module-hasDefaultTypography-Uy4EO Divider-module-genres-ezeLN">
                                                        <a class="Genre-module-container-HcI4x Genre-module-hasDefaultTypography-VC0YE Genre-module-link-kGNTi"
                                                           tabindex="-1" th:text="${movie.genre}"
                                                           th:href="@{'/movies/'+${movie.genre.toLowerCase()}}">
                                                            Genre type
                                                        </a>
                                                    </span>
                                                <span class="Divider-module-divider-U-3-- Divider-module-hasDefaultTypography-Uy4EO">
                                                        <span class="Year-module-container-60QAr Year-module-hasDefaultTypography-IO5bM"
                                                              th:text="${movie.releaseYear}">
                                                            Release year
                                                        </span>
                                                    </span>
                                                <span class="Divider-module-divider-U-3-- Divider-module-hasDefaultTypography-Uy4EO">
                                                        <span class="ParentalRating-module-container-lxbzk ParentalRating-module-hasDefaultTypography-UP2B1">
                                                            <span th:text="${movie.ageLimit} + ' lat'">
                                                                Age limit
                                                            </span>
                                                        </span>
                                                    </span>
                                            </p>
                                            <div class="ProductSynopsis-module-container-aYPIz">
                                                <div class="ProductSynopsis-module-synopsis-n5-Be">
                                                    <div class="Group-module-group--XDAf">
                                                        <div class="Synopsis-module-container-pmsNY Synopsis-module-hasDefaultTypography-5xyxY"
                                                             itemprop="description" th:text="${movie.description}">
                                                            Opis
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ProductPage-module-metaRight-EZCO3">
                                            <div class="ProductDetails-module-container-L6eB1">
                                                <div class="ProductDetails-module-people-TMICK">
                                                    <div class="Group-module-group--XDAf">
                                                        <div class="">
                                                            <div>
                                                                <span class="PeopleList-module-title-voAAo">
                                                                    Obsada
                                                                </span>
                                                                <div class="PeopleList-module-peoplearray-KNtVQ"
                                                                     th:text="${movie.staff}">

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="Audio-module-container-OTfgl">
                                                                <span class="Audio-module-title-57qKh">
                                                                    <span>Język</span>
                                                                </span>
                                                            <span class="Audio-module-audio-VqD-r"
                                                                  th:text="${movie.languages}">
                                                                    Polski
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>

                        <div class="Season-module-wrapper-H0oVh" data-testhook="season">
                            <div class="StickyDiv-module-mark-Me4XV StickyDiv-module-top-peA7i"
                                 style="top: 0px;"></div>
                            <div class="Carousel-module-container-o-YFo" data-testhook="carousel-container">
                                <div id="header-podobne-filmy" class="CarouselHeader-module-container-dBOIV"
                                     data-testhook="carousel-header">
                                    <section itemtype="">
                                        <div class="Scaffold-module-scaffold-F6aIC">
                                            <header class="CarouselHeader-module-wrapper-B8ict">
                                                <h2 class="Title-module-subheader--ZDhF undefined"
                                                    data-testhook="carousel-title">
                                                    Podobne filmy
                                                </h2>
                                            </header>
                                        </div>
                                    </section>
                                </div>
                                <div class="Carousel-module-carousel-NbPjL">
                                    <div class="Carousel-module-wrapper-QhccC">
                                        <button type="button"
                                                class="Carousel-module-navigation-crAaj Carousel-module-prev-EJuzt"></button>
                                        <div class="Carousel-module-inner-4oa8u Carousel-module-useTransition-vWyzl">
                                            <span>
                                                <div th:each="relatedMovies : ${moviesByGenre}"
                                                     class="Item-module-item-yTZtG Item-module-carouselItem-Q3n9V Item-module-landscapeItem-Sf-nw">
                                                    <div class="Item-module-box-4uBp3 Item-module-show-qrDtq">
                                                        <a class="Item-module-link-Lms-C" tabindex="-1"
                                                           th:with="formattedTitle=${relatedMovies.title.replace(' ', '-')}"
                                                           th:href="@{/movies/{formattedTitle}(formattedTitle=${formattedTitle})}">
                                                        </a>
                                                        <div class="Item-module-image-CGday"
                                                             th:style="'background-image: url(' + ${relatedMovies.imageUrl} + ');'">
                                                        </div>
                                                        <div class="Item-module-curtain-EV2Ya">
                                                            <div class="SeriesMeta-module-container-oFAL3">
                                                                <div class="SeriesMeta-module-metadata-8qwss">
                                                                    <span class="Divider-module-divider-U-3--">
                                                                        <a class="ImdbRating-module-link-yYfI- ImdbRating-module-hasDefaultTypography-luAjW"
                                                                           th:href="@{${relatedMovies.imdbUrl}}"
                                                                           target="_blank"
                                                                           tabindex="-1"
                                                                           th:text="${relatedMovies.imdbRating}">
                                                                            ImdbRating
                                                                        </a>
                                                                    </span>
                                                                    <span class="Divider-module-divider-U-3-- Divider-module-hasDefaultTypography-Uy4EO">
                                                                        <span class="Seasons-module-container-ZM15y Seasons-module-hasDefaultTypography-8No96">
                                                                            <span th:text="${relatedMovies.releaseYear}">
                                                                                ReleaseYear
                                                                            </span>
                                                                        </span>
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            <div class="InteractionIcons-module-container-apGgr">
                                                                <a class="TooltipButton-module-container-PfKnw TooltipButton-module-isItem-R6NdL"
                                                                   tabindex="-1"
                                                                   th:href="@{'/movies/' + ${relatedMovies.title.toLowerCase().replace(' ', '-')}}">
                                                                </a>
                                                                <div class="StarButton-module-container-sGC0y StarButton-module-isItem-SdwJH"
                                                                     data-testhook="item-star" th:classappend="${relatedMovies.onUserList ? 'StarButton-module-isStarred-v2AtG' : ''}"
                                                                     th:attr="data-imdb-id=${relatedMovies.imdbId}"></div>
                                                                <div class="RateButtons-module-container-oL7lm RateButtons-module-isItem-5vKa8 RateButtons-module-rateUp-S4se-"></div>
                                                                <div class="RateButtons-module-container-oL7lm RateButtons-module-isItem-5vKa8 RateButtons-module-rateDown-DblB1"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </span>
                                            <div class="Item-module-below-BMw6u Item-module-padding-kgN3F"></div>
                                        </div>
                                        <button type="button"
                                                class="Carousel-module-navigation-crAaj Carousel-module-next-AXbEv"></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div th:replace="~{footer :: footer}"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
<script type="text/javascript" src="/scripts/common.js"></script>
<script>
    document.querySelectorAll('.MyList-module-myList-kmBI5').forEach(button => {
        button.addEventListener('click', function () {
            var imdbId = this.getAttribute('data-imdb-id');

            var csrfToken = document.querySelector('meta[name="_csrf"]').content;
            var csrfHeader = document.querySelector('meta[name="_csrf_header"]').content;

            var headers = new Headers();
            headers.append(csrfHeader, csrfToken);

            var isStarred = this.classList.contains('MyList-module-active-T4Dnx');

            var method = isStarred ? 'DELETE' : 'POST';

            // Utwórz pełny adres URL
            var baseUrl = window.location.origin + '/library/';
            var apiUrl = (isStarred ? 'remove-from-list/' : 'add-to-list/') + imdbId;
            var fullUrl = baseUrl + apiUrl;

            fetch(fullUrl, {
                method: method,
                headers: headers
            })
                .then(response => {
                    if (response.ok) {
                        this.classList.toggle('MyList-module-active-T4Dnx', !isStarred);
                    }
                })
                .catch(error => console.error('Error:', error));
        });
    });
</script>

</body>
</html>